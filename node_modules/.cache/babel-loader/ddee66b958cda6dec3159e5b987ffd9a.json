{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\John Geliberte\\\\Work\\\\freelance\\\\m1\\\\src\\\\components\\\\Login\\\\Login.js\";\nimport React, { useState, useContext, useEffect } from \"react\";\nimport { AppContext } from \"../../AppContext\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { NavigationContext } from \"../Navigation/NavigationContext\";\nimport SignInCard from \"./SignInCard\";\nimport { Button, Typography } from \"@material-ui/core\";\nimport Paper from \"@material-ui/core/Paper\";\nimport styled from \"styled-components\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport RenderSignUpControls from \"./RenderSignUpControls\";\nimport { tenantsCredentials, msalConfig, loginRequest, readProfileRequest, authGraphQLRequest } from \"./AADAuthConfig\";\nimport * as msal from \"@azure/msal-browser\";\nconst localStyles = makeStyles(theme => ({\n  myRoot: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\"\n  },\n  footer: {\n    backgroundSize: \"cover\",\n    backgroundPosition: \"center\",\n    backgroundColor: \"#011133\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    paddingBottom: \"1%\"\n  },\n  headerWords: {\n    color: \"#011133\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    marginTop: \"30px\",\n    marginBottom: \"20px\",\n    fontSize: \"48px\",\n    fontWeight: \"900\",\n    fontFamily: \"Tahoma, Geneva, sans-serif\"\n  },\n  supportCard: {\n    width: \"375px\",\n    height: \"425px\",\n    backgroundColor: \"#e8eced\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    fontFamily: theme.typography.fontFamily\n  },\n  rootNewUser: {\n    textAlign: \"center\",\n    display: \"flex\",\n    height: \"100%\",\n    flexDirection: \"column\",\n    \"&::-webkit-scrollbar\": {\n      width: \"0 !important\"\n    }\n  },\n  cardContainer: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    justifyContent: \"center\"\n  }\n}));\n\nconst M1neralLogoNavNoAuth = props => /*#__PURE__*/React.createElement(\"svg\", {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 11320 2490\",\n  className: props.className,\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 3\n  }\n}, /*#__PURE__*/React.createElement(\"g\", {\n  fill: \"none\",\n  fillRule: \"evenodd\",\n  stroke: \"none\",\n  strokeWidth: \"1\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }\n}, /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"#12ABE0\",\n  d: \"M1396 1823c-201 202-528 202-729 0-15-15-30-31-43-48l-366 366c14 16 29 31 44 47 403 402 1056 402 1459 0 356-356 397-908 124-1309l-379 378c80 188 43 413-110 566zm-839-163c-80-188-43-413 110-566 201-201 528-201 729 0 16 15 30 32 43 48l366-366c-14-16-29-31-44-47L1032 0 302 729c-356 356-397 908-124 1309l379-378zm292-384c101-100 264-100 365 0 101 101 101 264 0 365s-264 101-365 0c-100-101-100-264 0-365z\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 7\n  }\n}), /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"translate(2687 379)\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 7\n  }\n}, /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"#12ABE0\",\n  d: \"M2703 1686L2703 64 2703 0 2505 64 2072 202 2132 432 2422 351 2422 1686z\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 9\n  }\n}), /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"white\",\n  d: \"M8354 6L8354 1686 8633 1686 8633 6z\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 9\n  }\n}), /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"white\",\n  d: \"M1324 699c156 0 246 103 246 297v690h279V911c0-297-161-465-426-465-184 0-313 85-412 214-65-129-187-214-362-214-186 0-292 101-370 209V471H0v1215h279v-683c0-189 106-304 260-304s246 106 246 295v692h279v-686c0-195 108-301 260-301zM3099 471v1215h278v-686c0-188 113-301 274-301 166 0 260 108 260 297v690h279V913c0-283-159-467-433-467-189 0-301 99-380 214V471h-278zM5053 446c-347 0-594 285-594 633v4c0 376 272 631 624 631 223 0 382-90 497-228l-163-145c-97 95-194 145-329 145-180 0-320-110-350-308h893c2-28 5-53 5-79 0-349-196-653-583-653zm306 548h-624c26-189 145-320 316-320 184 0 290 140 308 320zM5916 471v1215h279v-462c0-323 170-481 414-481h16V448c-214-9-354 115-430 297V471h-279zM6759 1086c0 345 274 628 644 628 142 0 269-41 373-110v110h279V446h-279v107c-102-68-228-107-368-107-373 0-649 287-649 635v5zm649 386c-216 0-371-179-371-391v-5c0-211 143-386 366-386 219 0 373 177 373 391v5c0 209-142 386-368 386z\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 9\n  }\n}))));\n\nconst M1neralLogo2 = styled(M1neralLogoNavNoAuth)`\n  width: 200px;\n  padding-top: 50px;\n  padding-bottom: 20px;\n`;\n\nconst Login = props => {\n  const [stateApp, setStateApp] = useContext(AppContext);\n  const [, setStateNav] = useContext(NavigationContext);\n  const localClass = localStyles();\n  const [signingIn, setSigningIn] = useState(false);\n  const [loadingSigInButton, setLoadingSigInButton] = useState(false);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    if (stateApp.myMSALObj && !signingIn) {\n      stateApp.myMSALObj.handleRedirectPromise().then(tokenResponse => {\n        const accountObj = tokenResponse ? tokenResponse.account : (() => {\n          const currentAccounts = stateApp.myMSALObj.getAllAccounts();\n          return currentAccounts && currentAccounts.length === 1 ? currentAccounts[0] : () => {\n            // Add choose account code here\n            return;\n          };\n        })();\n\n        if (accountObj) {\n          // Account object was retrieved, continue with app progress\n          console.log(\"id_token acquired at: \" + new Date().toString()); // Account object is now an array! what do we do if multiple users are signed in on the same browser?\n          // Passing first account as default for now\n\n          finishAADAuth(accountObj);\n        } else {\n          if (tokenResponse && tokenResponse.tokenType === \"Bearer\") {\n            // No account object available, but access token was retrieved\n            console.log(\"access_token acquired at: \" + new Date().toString());\n            console.log(\"now what???\");\n          } else if (tokenResponse === null) {// tokenResponse was null, attempt sign in or enter unauthenticated state for app\n          } else {\n            console.log(\"tokenResponse was not null but did not have any tokens: \" + tokenResponse);\n          }\n\n          setLoading(false);\n          sessionStorage.clear();\n          window.location.replace(window.location.origin);\n        }\n      }).catch(error => {\n        console.log(error);\n        sessionStorage.clear();\n        window.location.replace(window.location.origin);\n      });\n    } else {\n      if (stateApp.myMSALObj === false) setLoading(false);\n    }\n  }, [stateApp.myMSALObj, signingIn]);\n\n  const handledAADSignIn = async (tenantName, updateTenantFlags) => {\n    let tenant = tenantsCredentials(tenantName);\n\n    if (tenant) {\n      setSigningIn(true);\n      setLoadingSigInButton(true);\n      let myMSALObj = stateApp.myMSALObj;\n\n      if (!stateApp.myMSALObj) {\n        myMSALObj = new msal.PublicClientApplication(msalConfig(tenant.tenantId, tenant.clientId));\n        setStateApp({ ...stateApp,\n          myMSALObj,\n          apolloClientEndpoint: tenant.apolloClientEndpoint\n        });\n      }\n\n      window.sessionStorage.setItem(\"tenantName\", tenant.name);\n      const signInType = \"loginRedirect\";\n\n      if (signInType === \"loginPopup\") {\n        stateApp.myMSALObj = myMSALObj; /////\n\n        const loginResponse = await signInPopup(loginRequest).catch(error => {\n          //do some error stuff\n          console.log(error);\n          updateTenantFlags(error);\n          setLoadingSigInButton(false);\n        });\n\n        if (!loginResponse) {\n          //do some error stuff\n          updateTenantFlags(\"Log in Failed\");\n          setLoadingSigInButton(false);\n          return;\n        }\n\n        await finishAADAuth(loginResponse);\n      } else if (signInType === \"loginRedirect\") {\n        myMSALObj.loginRedirect(loginRequest);\n      }\n    } else {\n      updateTenantFlags(\"Wrong Tenant Name\");\n    }\n  };\n\n  async function finishAADAuth(accountObj) {\n    const request = {};\n    request.account = accountObj;\n    request.scopes = readProfileRequest.scopes;\n    request.loginHint = request.account.username;\n    const readProfileLoginResponse = await ssoSilent(request).catch(error => {\n      //do some error stuff\n      console.log(error);\n    });\n\n    if (!readProfileLoginResponse) {\n      //do some error stuff\n      return;\n    }\n\n    const readProfileToken = await getTokenPopup(request).catch(error => {\n      //do some error stuff\n      console.log(error);\n    });\n\n    if (!readProfileToken) {\n      //do some error stuff\n      return;\n    }\n\n    const readProfileResponse = await callMSGraph(\"https://graph.microsoft.com/v1.0/me\", readProfileToken.accessToken).catch(error => {\n      //do some error stuff\n      console.log(error);\n    });\n\n    if (!readProfileResponse) {\n      //do some error stuff\n      return;\n    }\n\n    request.scopes = authGraphQLRequest.scopes;\n    request.loginHint = request.account.username;\n    const authGraphQLLoginResponse = await ssoSilent(request).catch(error => {\n      //do some error stuff\n      console.log(error);\n    });\n\n    if (!authGraphQLLoginResponse) {\n      //do some error stuff\n      return;\n    }\n\n    authGraphQLRequest.account = request.account;\n    const authGraphQLToken = await getTokenPopup(authGraphQLRequest).catch(error => {\n      //do some error stuff\n      console.log(error);\n    });\n\n    if (!authGraphQLToken) {\n      //do some error stuff\n      return;\n    }\n\n    const authGraphQLResponse = await callAuthGraphQL(`${new URL(stateApp.apolloClientEndpoint).origin}/.auth/login/aad`, authGraphQLToken.accessToken).catch(error => {\n      //do some error stuff\n      console.log(error);\n    });\n\n    if (!authGraphQLResponse) {\n      //do some error stuff\n      return;\n    }\n\n    const graphQLProfileResponse = await callProfileGraphQL(`${new URL(stateApp.apolloClientEndpoint).origin}/.auth/me`, authGraphQLResponse.authenticationToken).catch(error => {\n      //do some error stuff\n      console.log(error);\n    });\n\n    if (!graphQLProfileResponse) {\n      //do some error stuff\n      return;\n    } // const graphQLRefreshResponse = await callProfileGraphQL(\"https://m1graphql.azurewebsites.net/.auth/refresh\", authGraphQLResponse.authenticationToken).catch(error => {\n    //   //do some error stuff\n    //   console.log(error);\n    // });\n    // if (!graphQLRefreshResponse) {\n    //   //do some error stuff\n    //   return;\n    // }\n    // const graphQLProfileResponse2 = await callProfileGraphQL(\"https://m1graphql.azurewebsites.net/.auth/me\", authGraphQLResponse.authenticationToken).catch(error => {\n    //   //do some error stuff\n    //   console.log(error);\n    // });\n    // if (!graphQLProfileResponse2) {\n    //   //do some error stuff\n    //   return;\n    // }\n\n\n    const mongoUser = await getMongoDBUser({\n      email: readProfileResponse.mail ? readProfileResponse.mail : readProfileResponse.userPrincipalName,\n      name: readProfileResponse.displayName\n    }, authGraphQLResponse.authenticationToken).catch(error => {\n      //do some error stuff\n      console.log(error);\n    });\n\n    if (!mongoUser) {\n      //do some error stuff\n      return;\n    }\n\n    setStateApp(state => ({ ...state,\n      user: {\n        id: readProfileResponse.id,\n        mongoId: mongoUser._id,\n        email: readProfileResponse.mail ? readProfileResponse.mail : readProfileResponse.userPrincipalName,\n        name: readProfileResponse.displayName,\n        authToken: authGraphQLResponse.authenticationToken,\n        authTokenExpires: new Date(authGraphQLToken.expiresOn.setDate(authGraphQLToken.expiresOn.getDate() + 14)),\n        tenant: {\n          id: request.tenantId,\n          tenant: \"M1neral\",\n          graphQL: {\n            endpoint: \"https://m1graphql.azurewebsites.net/api/m1neral?code=kNAzP9HYSsEwdWhlLa55AIGeKj2iiFFOpXaTMRh9IuTODWpNobIX3g==\"\n          }\n        }\n      }\n    }));\n    setStateNav(stateNav => ({ ...stateNav,\n      defaultOn: true\n    }));\n    setLoadingSigInButton(false);\n    setLoading(false);\n  }\n\n  async function getMongoDBUser(user, accessToken) {\n    const mutation = `\n      mutation getFindOrCreateUser($user: UserInput) {\n        findOrCreateUser(user: $user) {\n          success\n          message\n          user {\n            _id\n            email\n            name\n            }\n          }\n        }\n       `;\n    var options = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-ZUMO-AUTH\": accessToken\n      },\n      body: JSON.stringify({\n        query: mutation,\n        variables: {\n          user\n        }\n      })\n    };\n    return await fetch(stateApp.apolloClientEndpoint, options).then(response => response.json()).then(response => {\n      return response && response.data && response.data.findOrCreateUser && response.data.findOrCreateUser.success ? response.data.findOrCreateUser.user : null;\n    }).catch(error => console.log(error));\n  }\n\n  async function signInPopup(request) {\n    console.log(\"request made to signIn at: \" + new Date().toString());\n    console.log(\"scopes requested: \" + request.scopes.toString());\n    const loginResponse = await stateApp.myMSALObj.loginPopup(request).catch(function (error) {\n      console.log(error);\n    });\n    console.log(loginResponse);\n\n    if (stateApp.myMSALObj.getAllAccounts()) {\n      return loginResponse;\n    }\n  }\n\n  async function ssoSilent(request) {\n    console.log(\"request made to ssoSilent at: \" + new Date().toString());\n    console.log(\"scopes requested: \" + request.scopes.toString());\n    stateApp.myMSALObj.config.auth.redirectUri = msalConfig().auth.redirectUri + \"auth.html\";\n    const loginResponse = await stateApp.myMSALObj.ssoSilent(request).catch(function (error) {\n      console.log(error);\n    });\n    stateApp.myMSALObj.config.auth.redirectUri = msalConfig().auth.redirectUri;\n    console.log(loginResponse);\n\n    if (stateApp.myMSALObj.getAllAccounts()) {\n      return loginResponse;\n    }\n  }\n\n  async function getTokenPopup(request) {\n    console.log(\"request made to getTokenPopup at: \" + new Date().toString());\n    console.log(\"scopes requested: \" + request.scopes.toString());\n    return await stateApp.myMSALObj.acquireTokenSilent(request).catch(async error => {\n      console.log(\"silent token acquisition fails.\");\n\n      if (error instanceof msal.InteractionRequiredAuthError) {\n        console.log(\"acquiring token using popup\");\n        return stateApp.myMSALObj.acquireTokenPopup(request).catch(error => {\n          console.error(error);\n        });\n      } else {\n        console.error(error);\n      }\n    });\n  }\n\n  async function callMSGraph(endpoint, accessToken) {\n    const headers = new Headers();\n    const bearer = `Bearer ${accessToken}`;\n    headers.append(\"Authorization\", bearer);\n    const options = {\n      method: \"GET\",\n      headers: headers\n    };\n    console.log(\"request made to Graph profile at: \" + new Date().toString());\n    return await fetch(endpoint, options).then(response => response.json()).then(response => {\n      console.log(response);\n      return response;\n    }).catch(error => console.log(error));\n  }\n\n  async function callAuthGraphQL(endpoint, accessToken) {\n    const headers = new Headers();\n    const options = {\n      method: \"POST\",\n      headers: headers,\n      body: JSON.stringify({\n        access_token: accessToken\n      })\n    };\n    console.log(\"request made to GraphQL login at: \" + new Date().toString());\n    return await fetch(endpoint, options).then(response => response.json()).then(response => {\n      console.log(response);\n      return response;\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  async function callProfileGraphQL(endpoint, accessToken) {\n    const headers = new Headers();\n    headers.append(\"X-ZUMO-AUTH\", accessToken);\n    const options = {\n      method: \"GET\",\n      headers: headers\n    };\n    console.log(\"request made to GraphQL profile at: \" + new Date().toString());\n    return await fetch(endpoint, options).then(response => response.json()).then(response => response[0]).then(response => {\n      console.log(response);\n      return response;\n    }).catch(error => console.log(error));\n  }\n\n  const renderBody = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 525,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h4\",\n    className: localClass.headerWords,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 526,\n      columnNumber: 9\n    }\n  }, \"Welcome back!\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: localClass.cardContainer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 531,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(SignInCard, {\n    ready: loadingSigInButton,\n    handleAADSignIn: handledAADSignIn,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 532,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 537,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Paper, {\n    elevation: 0,\n    square: true,\n    color: \"secondary\",\n    className: localClass.supportCard,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 538,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 544,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    style: {\n      marginTop: \"75px\",\n      fontSize: \"24px\",\n      fontWeight: \"900\",\n      fontFamily: \"Tahoma, Geneva, sans-serif\",\n      textAlign: \"left\",\n      paddingLeft: \"65px\",\n      paddingRight: \"45px\",\n      color: \"#011133\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 545,\n      columnNumber: 15\n    }\n  }, \"Have questions about your account? Need help signing up?\")), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 560,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    style: {\n      marginTop: \"25px\",\n      fontSize: \"18px\",\n      fontFamily: \"Tahoma, Geneva, sans-serif\",\n      textAlign: \"left\",\n      paddingLeft: \"65px\",\n      paddingRight: \"45px\",\n      color: \"#011133\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 561,\n      columnNumber: 15\n    }\n  }, \"Our support team is available and ready to help with any questions that you might have.\")), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    href: `mailto:support@m1neral.com`,\n    target: \"_blank\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 577,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    disableElevation: true,\n    type: \"submit\",\n    style: {\n      float: \"left\",\n      marginTop: \"35px\",\n      marginLeft: \"65px\"\n    },\n    color: \"secondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 578,\n      columnNumber: 17\n    }\n  }, \"Contact Support\")))))));\n  return loading ? /*#__PURE__*/React.createElement(CircularProgress, {\n    size: 80,\n    disableShrink: true,\n    color: \"secondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 600,\n      columnNumber: 5\n    }\n  }) : /*#__PURE__*/React.createElement(\"div\", {\n    className: localClass.myRoot,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 602,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: localClass.rootNewUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 603,\n      columnNumber: 7\n    }\n  }, renderBody), /*#__PURE__*/React.createElement(\"div\", {\n    className: localClass.rootNewUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 605,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(RenderSignUpControls, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 606,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: localClass.footer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 609,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 610,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(M1neralLogo2, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 611,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      color: \"#fff\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 614,\n      columnNumber: 9\n    }\n  }, \"\\xA9 2020 M1neral, LLC. All Rights Reserved.\"), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      color: \"#fff\",\n      marginBottom: \"50px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 630,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default Login;","map":{"version":3,"sources":["C:/Users/John Geliberte/Work/freelance/m1/src/components/Login/Login.js"],"names":["React","useState","useContext","useEffect","AppContext","makeStyles","NavigationContext","SignInCard","Button","Typography","Paper","styled","CircularProgress","RenderSignUpControls","tenantsCredentials","msalConfig","loginRequest","readProfileRequest","authGraphQLRequest","msal","localStyles","theme","myRoot","display","flexDirection","justifyContent","footer","backgroundSize","backgroundPosition","backgroundColor","alignItems","paddingBottom","headerWords","color","marginTop","marginBottom","fontSize","fontWeight","fontFamily","supportCard","width","height","typography","rootNewUser","textAlign","cardContainer","M1neralLogoNavNoAuth","props","className","M1neralLogo2","Login","stateApp","setStateApp","setStateNav","localClass","signingIn","setSigningIn","loadingSigInButton","setLoadingSigInButton","loading","setLoading","myMSALObj","handleRedirectPromise","then","tokenResponse","accountObj","account","currentAccounts","getAllAccounts","length","console","log","Date","toString","finishAADAuth","tokenType","sessionStorage","clear","window","location","replace","origin","catch","error","handledAADSignIn","tenantName","updateTenantFlags","tenant","PublicClientApplication","tenantId","clientId","apolloClientEndpoint","setItem","name","signInType","loginResponse","signInPopup","loginRedirect","request","scopes","loginHint","username","readProfileLoginResponse","ssoSilent","readProfileToken","getTokenPopup","readProfileResponse","callMSGraph","accessToken","authGraphQLLoginResponse","authGraphQLToken","authGraphQLResponse","callAuthGraphQL","URL","graphQLProfileResponse","callProfileGraphQL","authenticationToken","mongoUser","getMongoDBUser","email","mail","userPrincipalName","displayName","state","user","id","mongoId","_id","authToken","authTokenExpires","expiresOn","setDate","getDate","graphQL","endpoint","stateNav","defaultOn","mutation","options","method","headers","body","JSON","stringify","query","variables","fetch","response","json","data","findOrCreateUser","success","loginPopup","config","auth","redirectUri","acquireTokenSilent","InteractionRequiredAuthError","acquireTokenPopup","Headers","bearer","append","access_token","renderBody","paddingLeft","paddingRight","float","marginLeft"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from \"react\";\r\nimport { AppContext } from \"../../AppContext\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport { NavigationContext } from \"../Navigation/NavigationContext\";\r\nimport SignInCard from \"./SignInCard\";\r\nimport { Button, Typography } from \"@material-ui/core\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport styled from \"styled-components\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\nimport RenderSignUpControls from \"./RenderSignUpControls\";\r\n\r\nimport {\r\n  tenantsCredentials,\r\n  msalConfig,\r\n  loginRequest,\r\n  readProfileRequest,\r\n  authGraphQLRequest,\r\n} from \"./AADAuthConfig\";\r\nimport * as msal from \"@azure/msal-browser\";\r\n\r\nconst localStyles = makeStyles((theme) => ({\r\n  myRoot: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    justifyContent: \"center\",\r\n  },\r\n  footer: {\r\n    backgroundSize: \"cover\",\r\n    backgroundPosition: \"center\",\r\n    backgroundColor: \"#011133\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    alignItems: \"center\",\r\n    paddingBottom: \"1%\",\r\n  },\r\n  headerWords: {\r\n    color: \"#011133\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    marginTop: \"30px\",\r\n    marginBottom: \"20px\",\r\n    fontSize: \"48px\",\r\n    fontWeight: \"900\",\r\n    fontFamily: \"Tahoma, Geneva, sans-serif\",\r\n  },\r\n  supportCard: {\r\n    width: \"375px\",\r\n    height: \"425px\",\r\n    backgroundColor: \"#e8eced\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    fontFamily: theme.typography.fontFamily,\r\n  },\r\n  rootNewUser: {\r\n    textAlign: \"center\",\r\n    display: \"flex\",\r\n    height: \"100%\",\r\n    flexDirection: \"column\",\r\n    \"&::-webkit-scrollbar\": {\r\n      width: \"0 !important\",\r\n    },\r\n  },\r\n  cardContainer: {\r\n    display: \"flex\",\r\n    flexDirection: \"row\",\r\n    justifyContent: \"center\",\r\n  },\r\n}));\r\n\r\nconst M1neralLogoNavNoAuth = (props) => (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    viewBox=\"0 0 11320 2490\"\r\n    className={props.className}\r\n  >\r\n    <g fill=\"none\" fillRule=\"evenodd\" stroke=\"none\" strokeWidth=\"1\">\r\n      <path\r\n        fill=\"#12ABE0\"\r\n        d=\"M1396 1823c-201 202-528 202-729 0-15-15-30-31-43-48l-366 366c14 16 29 31 44 47 403 402 1056 402 1459 0 356-356 397-908 124-1309l-379 378c80 188 43 413-110 566zm-839-163c-80-188-43-413 110-566 201-201 528-201 729 0 16 15 30 32 43 48l366-366c-14-16-29-31-44-47L1032 0 302 729c-356 356-397 908-124 1309l379-378zm292-384c101-100 264-100 365 0 101 101 101 264 0 365s-264 101-365 0c-100-101-100-264 0-365z\"\r\n      ></path>\r\n      <g transform=\"translate(2687 379)\">\r\n        <path\r\n          fill=\"#12ABE0\"\r\n          d=\"M2703 1686L2703 64 2703 0 2505 64 2072 202 2132 432 2422 351 2422 1686z\"\r\n        ></path>\r\n        <path fill=\"white\" d=\"M8354 6L8354 1686 8633 1686 8633 6z\"></path>\r\n        <path\r\n          fill=\"white\"\r\n          d=\"M1324 699c156 0 246 103 246 297v690h279V911c0-297-161-465-426-465-184 0-313 85-412 214-65-129-187-214-362-214-186 0-292 101-370 209V471H0v1215h279v-683c0-189 106-304 260-304s246 106 246 295v692h279v-686c0-195 108-301 260-301zM3099 471v1215h278v-686c0-188 113-301 274-301 166 0 260 108 260 297v690h279V913c0-283-159-467-433-467-189 0-301 99-380 214V471h-278zM5053 446c-347 0-594 285-594 633v4c0 376 272 631 624 631 223 0 382-90 497-228l-163-145c-97 95-194 145-329 145-180 0-320-110-350-308h893c2-28 5-53 5-79 0-349-196-653-583-653zm306 548h-624c26-189 145-320 316-320 184 0 290 140 308 320zM5916 471v1215h279v-462c0-323 170-481 414-481h16V448c-214-9-354 115-430 297V471h-279zM6759 1086c0 345 274 628 644 628 142 0 269-41 373-110v110h279V446h-279v107c-102-68-228-107-368-107-373 0-649 287-649 635v5zm649 386c-216 0-371-179-371-391v-5c0-211 143-386 366-386 219 0 373 177 373 391v5c0 209-142 386-368 386z\"\r\n        ></path>\r\n      </g>\r\n    </g>\r\n  </svg>\r\n);\r\n\r\nconst M1neralLogo2 = styled(M1neralLogoNavNoAuth)`\r\n  width: 200px;\r\n  padding-top: 50px;\r\n  padding-bottom: 20px;\r\n`;\r\n\r\nconst Login = (props) => {\r\n  const [stateApp, setStateApp] = useContext(AppContext);\r\n  const [, setStateNav] = useContext(NavigationContext);\r\n\r\n  const localClass = localStyles();\r\n  const [signingIn, setSigningIn] = useState(false);\r\n  const [loadingSigInButton, setLoadingSigInButton] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (stateApp.myMSALObj && !signingIn) {\r\n      stateApp.myMSALObj\r\n        .handleRedirectPromise()\r\n        .then((tokenResponse) => {\r\n\r\n          const accountObj = tokenResponse\r\n            ? tokenResponse.account\r\n            : (() => { \r\n              const currentAccounts = stateApp.myMSALObj.getAllAccounts();\r\n              return currentAccounts && currentAccounts.length === 1\r\n                ? currentAccounts[0]\r\n                : () => {\r\n                  // Add choose account code here\r\n                  return;\r\n                }\r\n            })();\r\n\r\n          if (accountObj) {\r\n            // Account object was retrieved, continue with app progress\r\n            console.log(\"id_token acquired at: \" + new Date().toString());\r\n            // Account object is now an array! what do we do if multiple users are signed in on the same browser?\r\n            // Passing first account as default for now\r\n            finishAADAuth(accountObj);\r\n          } else {\r\n            if (tokenResponse && tokenResponse.tokenType === \"Bearer\") {\r\n              // No account object available, but access token was retrieved\r\n              console.log(\"access_token acquired at: \" + new Date().toString());\r\n              console.log(\"now what???\");\r\n            } else if (tokenResponse === null) {\r\n              // tokenResponse was null, attempt sign in or enter unauthenticated state for app\r\n            } else {\r\n              console.log(\r\n                \"tokenResponse was not null but did not have any tokens: \" +\r\n                  tokenResponse\r\n              );\r\n            }\r\n            setLoading(false);\r\n\r\n            sessionStorage.clear();\r\n            window.location.replace(window.location.origin);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.log(error);\r\n          sessionStorage.clear();\r\n          window.location.replace(window.location.origin);\r\n        });\r\n    } else {\r\n      if (stateApp.myMSALObj === false) setLoading(false);\r\n    }\r\n  }, [stateApp.myMSALObj, signingIn]);\r\n\r\n  const handledAADSignIn = async (tenantName, updateTenantFlags) => {\r\n    let tenant = tenantsCredentials(tenantName);\r\n    if (tenant) {\r\n      setSigningIn(true);\r\n      setLoadingSigInButton(true);\r\n\r\n      let myMSALObj = stateApp.myMSALObj;\r\n\r\n      if (!stateApp.myMSALObj) {\r\n        myMSALObj = new msal.PublicClientApplication(\r\n          msalConfig(tenant.tenantId, tenant.clientId)\r\n        );\r\n\r\n        setStateApp({\r\n          ...stateApp,\r\n          myMSALObj,\r\n          apolloClientEndpoint: tenant.apolloClientEndpoint,\r\n        });\r\n      }\r\n\r\n      window.sessionStorage.setItem(\"tenantName\", tenant.name);\r\n\r\n      const signInType = \"loginRedirect\";\r\n\r\n      if (signInType === \"loginPopup\") {\r\n        stateApp.myMSALObj = myMSALObj; /////\r\n        const loginResponse = await signInPopup(loginRequest).catch((error) => {\r\n          //do some error stuff\r\n          console.log(error);\r\n          updateTenantFlags(error);\r\n          setLoadingSigInButton(false);\r\n        });\r\n        if (!loginResponse) {\r\n          //do some error stuff\r\n          updateTenantFlags(\"Log in Failed\");\r\n          setLoadingSigInButton(false);\r\n\r\n          return;\r\n        }\r\n\r\n        await finishAADAuth(loginResponse);\r\n      } else if (signInType === \"loginRedirect\") {\r\n        myMSALObj.loginRedirect(loginRequest);\r\n      }\r\n    } else {\r\n      updateTenantFlags(\"Wrong Tenant Name\");\r\n    }\r\n  };\r\n\r\n  async function finishAADAuth(accountObj) {\r\n    const request = {};\r\n    request.account = accountObj;\r\n\r\n    request.scopes = readProfileRequest.scopes;\r\n    request.loginHint = request.account.username;\r\n    const readProfileLoginResponse = await ssoSilent(request).catch((error) => {\r\n      //do some error stuff\r\n      console.log(error);\r\n    });\r\n    if (!readProfileLoginResponse) {\r\n      //do some error stuff\r\n      return;\r\n    }\r\n\r\n    const readProfileToken = await getTokenPopup(request).catch((error) => {\r\n      //do some error stuff\r\n      console.log(error);\r\n    });\r\n    if (!readProfileToken) {\r\n      //do some error stuff\r\n      return;\r\n    }\r\n\r\n    const readProfileResponse = await callMSGraph(\r\n      \"https://graph.microsoft.com/v1.0/me\",\r\n      readProfileToken.accessToken\r\n    ).catch((error) => {\r\n      //do some error stuff\r\n      console.log(error);\r\n    });\r\n    if (!readProfileResponse) {\r\n      //do some error stuff\r\n      return;\r\n    }\r\n\r\n    request.scopes = authGraphQLRequest.scopes;\r\n    request.loginHint = request.account.username;\r\n    const authGraphQLLoginResponse = await ssoSilent(request).catch((error) => {\r\n      //do some error stuff\r\n      console.log(error);\r\n    });\r\n    if (!authGraphQLLoginResponse) {\r\n      //do some error stuff\r\n      return;\r\n    }\r\n\r\n    authGraphQLRequest.account = request.account;\r\n    const authGraphQLToken = await getTokenPopup(authGraphQLRequest).catch(\r\n      (error) => {\r\n        //do some error stuff\r\n        console.log(error);\r\n      }\r\n    );\r\n    if (!authGraphQLToken) {\r\n      //do some error stuff\r\n      return;\r\n    }\r\n\r\n    const authGraphQLResponse = await callAuthGraphQL(\r\n      `${new URL(stateApp.apolloClientEndpoint).origin}/.auth/login/aad`,\r\n      authGraphQLToken.accessToken\r\n    ).catch((error) => {\r\n      //do some error stuff\r\n      console.log(error);\r\n    });\r\n    if (!authGraphQLResponse) {\r\n      //do some error stuff\r\n      return;\r\n    }\r\n\r\n    const graphQLProfileResponse = await callProfileGraphQL(\r\n      `${new URL(stateApp.apolloClientEndpoint).origin}/.auth/me`,\r\n      authGraphQLResponse.authenticationToken\r\n    ).catch((error) => {\r\n      //do some error stuff\r\n      console.log(error);\r\n    });\r\n    if (!graphQLProfileResponse) {\r\n      //do some error stuff\r\n      return;\r\n    }\r\n\r\n    // const graphQLRefreshResponse = await callProfileGraphQL(\"https://m1graphql.azurewebsites.net/.auth/refresh\", authGraphQLResponse.authenticationToken).catch(error => {\r\n    //   //do some error stuff\r\n    //   console.log(error);\r\n    // });\r\n    // if (!graphQLRefreshResponse) {\r\n    //   //do some error stuff\r\n    //   return;\r\n    // }\r\n\r\n    // const graphQLProfileResponse2 = await callProfileGraphQL(\"https://m1graphql.azurewebsites.net/.auth/me\", authGraphQLResponse.authenticationToken).catch(error => {\r\n    //   //do some error stuff\r\n    //   console.log(error);\r\n    // });\r\n    // if (!graphQLProfileResponse2) {\r\n    //   //do some error stuff\r\n    //   return;\r\n    // }\r\n\r\n    const mongoUser = await getMongoDBUser(\r\n      {\r\n        email: readProfileResponse.mail\r\n          ? readProfileResponse.mail\r\n          : readProfileResponse.userPrincipalName,\r\n        name: readProfileResponse.displayName,\r\n      },\r\n      authGraphQLResponse.authenticationToken\r\n    ).catch((error) => {\r\n      //do some error stuff\r\n      console.log(error);\r\n    });\r\n    if (!mongoUser) {\r\n      //do some error stuff\r\n      return;\r\n    }\r\n\r\n    setStateApp((state) => ({\r\n      ...state,\r\n      user: {\r\n        id: readProfileResponse.id,\r\n        mongoId: mongoUser._id,\r\n        email: readProfileResponse.mail\r\n          ? readProfileResponse.mail\r\n          : readProfileResponse.userPrincipalName,\r\n        name: readProfileResponse.displayName,\r\n        authToken: authGraphQLResponse.authenticationToken,\r\n        authTokenExpires: new Date(\r\n          authGraphQLToken.expiresOn.setDate(\r\n            authGraphQLToken.expiresOn.getDate() + 14\r\n          )\r\n        ),\r\n        tenant: {\r\n          id: request.tenantId,\r\n          tenant: \"M1neral\",\r\n          graphQL: {\r\n            endpoint:\r\n              \"https://m1graphql.azurewebsites.net/api/m1neral?code=kNAzP9HYSsEwdWhlLa55AIGeKj2iiFFOpXaTMRh9IuTODWpNobIX3g==\",\r\n          },\r\n        },\r\n      },\r\n    }));\r\n\r\n    setStateNav((stateNav) => ({ ...stateNav, defaultOn: true }));\r\n\r\n    setLoadingSigInButton(false);\r\n    setLoading(false);\r\n  }\r\n\r\n  async function getMongoDBUser(user, accessToken) {\r\n    const mutation = `\r\n      mutation getFindOrCreateUser($user: UserInput) {\r\n        findOrCreateUser(user: $user) {\r\n          success\r\n          message\r\n          user {\r\n            _id\r\n            email\r\n            name\r\n            }\r\n          }\r\n        }\r\n       `;\r\n\r\n    var options = {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"X-ZUMO-AUTH\": accessToken,\r\n      },\r\n      body: JSON.stringify({ query: mutation, variables: { user } }),\r\n    };\r\n\r\n    return await fetch(stateApp.apolloClientEndpoint, options)\r\n      .then((response) => response.json())\r\n      .then((response) => {\r\n        return response &&\r\n          response.data &&\r\n          response.data.findOrCreateUser &&\r\n          response.data.findOrCreateUser.success\r\n          ? response.data.findOrCreateUser.user\r\n          : null;\r\n      })\r\n      .catch((error) => console.log(error));\r\n  }\r\n\r\n  async function signInPopup(request) {\r\n    console.log(\"request made to signIn at: \" + new Date().toString());\r\n    console.log(\"scopes requested: \" + request.scopes.toString());\r\n\r\n    const loginResponse = await stateApp.myMSALObj\r\n      .loginPopup(request)\r\n      .catch(function (error) {\r\n        console.log(error);\r\n      });\r\n    console.log(loginResponse);\r\n    if (stateApp.myMSALObj.getAllAccounts()) {\r\n      return loginResponse;\r\n    }\r\n  }\r\n\r\n  async function ssoSilent(request) {\r\n    console.log(\"request made to ssoSilent at: \" + new Date().toString());\r\n    console.log(\"scopes requested: \" + request.scopes.toString());\r\n\r\n    stateApp.myMSALObj.config.auth.redirectUri =\r\n      msalConfig().auth.redirectUri + \"auth.html\";\r\n\r\n    const loginResponse = await stateApp.myMSALObj\r\n      .ssoSilent(request)\r\n      .catch(function (error) {\r\n        console.log(error);\r\n      });\r\n\r\n    stateApp.myMSALObj.config.auth.redirectUri = msalConfig().auth.redirectUri;\r\n\r\n    console.log(loginResponse);\r\n    if (stateApp.myMSALObj.getAllAccounts()) {\r\n      return loginResponse;\r\n    }\r\n  }\r\n\r\n  async function getTokenPopup(request) {\r\n    console.log(\"request made to getTokenPopup at: \" + new Date().toString());\r\n    console.log(\"scopes requested: \" + request.scopes.toString());\r\n\r\n    return await stateApp.myMSALObj\r\n      .acquireTokenSilent(request)\r\n      .catch(async (error) => {\r\n        console.log(\"silent token acquisition fails.\");\r\n        if (error instanceof msal.InteractionRequiredAuthError) {\r\n          console.log(\"acquiring token using popup\");\r\n          return stateApp.myMSALObj\r\n            .acquireTokenPopup(request)\r\n            .catch((error) => {\r\n              console.error(error);\r\n            });\r\n        } else {\r\n          console.error(error);\r\n        }\r\n      });\r\n  }\r\n\r\n  async function callMSGraph(endpoint, accessToken) {\r\n    const headers = new Headers();\r\n    const bearer = `Bearer ${accessToken}`;\r\n\r\n    headers.append(\"Authorization\", bearer);\r\n\r\n    const options = {\r\n      method: \"GET\",\r\n      headers: headers,\r\n    };\r\n\r\n    console.log(\"request made to Graph profile at: \" + new Date().toString());\r\n\r\n    return await fetch(endpoint, options)\r\n      .then((response) => response.json())\r\n      .then((response) => {\r\n        console.log(response);\r\n        return response;\r\n      })\r\n      .catch((error) => console.log(error));\r\n  }\r\n\r\n  async function callAuthGraphQL(endpoint, accessToken) {\r\n    const headers = new Headers();\r\n\r\n    const options = {\r\n      method: \"POST\",\r\n      headers: headers,\r\n      body: JSON.stringify({ access_token: accessToken }),\r\n    };\r\n\r\n    console.log(\"request made to GraphQL login at: \" + new Date().toString());\r\n\r\n    return await fetch(endpoint, options)\r\n      .then((response) => response.json())\r\n      .then((response) => {\r\n        console.log(response);\r\n        return response;\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      })\r\n  }\r\n\r\n  async function callProfileGraphQL(endpoint, accessToken) {\r\n    const headers = new Headers();\r\n\r\n    headers.append(\"X-ZUMO-AUTH\", accessToken);\r\n\r\n    const options = {\r\n      method: \"GET\",\r\n      headers: headers,\r\n    };\r\n\r\n    console.log(\"request made to GraphQL profile at: \" + new Date().toString());\r\n\r\n    return await fetch(endpoint, options)\r\n      .then((response) => response.json())\r\n      .then((response) => response[0])\r\n      .then((response) => {\r\n        console.log(response);\r\n        return response;\r\n      })\r\n      .catch((error) => console.log(error));\r\n  }\r\n\r\n  const renderBody = (\r\n    <>\r\n      <div>\r\n        <Typography variant=\"h4\" className={localClass.headerWords}>\r\n          Welcome back!\r\n        </Typography>\r\n      </div>\r\n\r\n      <div className={localClass.cardContainer}>\r\n        <SignInCard\r\n          ready={loadingSigInButton}\r\n          handleAADSignIn={handledAADSignIn}\r\n        />\r\n\r\n        <div>\r\n          <Paper\r\n            elevation={0}\r\n            square={true}\r\n            color=\"secondary\"\r\n            className={localClass.supportCard}\r\n          >\r\n            <div>\r\n              <Typography\r\n                style={{\r\n                  marginTop: \"75px\",\r\n                  fontSize: \"24px\",\r\n                  fontWeight: \"900\",\r\n                  fontFamily: \"Tahoma, Geneva, sans-serif\",\r\n                  textAlign: \"left\",\r\n                  paddingLeft: \"65px\",\r\n                  paddingRight: \"45px\",\r\n                  color: \"#011133\",\r\n                }}\r\n              >\r\n                Have questions about your account? Need help signing up?\r\n              </Typography>\r\n            </div>\r\n            <div>\r\n              <Typography\r\n                style={{\r\n                  marginTop: \"25px\",\r\n                  fontSize: \"18px\",\r\n                  fontFamily: \"Tahoma, Geneva, sans-serif\",\r\n                  textAlign: \"left\",\r\n                  paddingLeft: \"65px\",\r\n                  paddingRight: \"45px\",\r\n                  color: \"#011133\",\r\n                }}\r\n              >\r\n                Our support team is available and ready to help with any\r\n                questions that you might have.\r\n              </Typography>\r\n            </div>\r\n            <div>\r\n              <a href={`mailto:support@m1neral.com`} target=\"_blank\">\r\n                <Button\r\n                  variant=\"contained\"\r\n                  disableElevation\r\n                  type=\"submit\"\r\n                  style={{\r\n                    float: \"left\",\r\n                    marginTop: \"35px\",\r\n                    marginLeft: \"65px\",\r\n                  }}\r\n                  color=\"secondary\"\r\n                >\r\n                  Contact Support\r\n                </Button>\r\n              </a>\r\n            </div>\r\n          </Paper>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n\r\n  return loading ? (\r\n    <CircularProgress size={80} disableShrink color=\"secondary\" />\r\n  ) : (\r\n    <div className={localClass.myRoot}>\r\n      <div className={localClass.rootNewUser}>{renderBody}</div>\r\n\r\n      <div className={localClass.rootNewUser}>\r\n        <RenderSignUpControls />\r\n      </div>\r\n\r\n      <div className={localClass.footer}>\r\n        <div>\r\n          <M1neralLogo2 />\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            color: \"#fff\",\r\n          }}\r\n        >\r\n           2020 M1neral, LLC. All Rights Reserved.\r\n        </div>\r\n\r\n        {/* <div\r\n          style={{\r\n            color: \"#fff\",\r\n          }}\r\n        >\r\n          Terms of Service | Privacy Policy\r\n        </div> */}\r\n\r\n        <div\r\n          style={{\r\n            color: \"#fff\",\r\n            marginBottom: \"50px\",\r\n          }}\r\n        >\r\n          {/* Privacy Policy */}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"]},"metadata":{},"sourceType":"module"}